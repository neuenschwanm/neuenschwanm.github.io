<!DOCTYPE html>
<html lang="en">

	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0"
		>
		<title>Calculate Z'</title>
		<style>
			label, button {
				display: block;
				margin: 2em;
			}
			input {
				width: 3.5em;
			}
		</style>
		
		<script>

		//Z' factor calculation tool for HTS Screening
		//Martin Neuenschwander, 16.aug.2022

		function text_to_numeric_array (mytext) {
			
			const arrOfStr = mytext.split("\n");			
			const arrOfNum = [];

				for(let s of arrOfStr) {
				
					//test if it is not an empty string, this would be converted to 0
					if (s.length > 0) {
						//test if the conversion of the string is NaN, if not, add to the numeric array
						if (!Number.isNaN(Number(s))) {
						arrOfNum.push(Number(s));
						}
					}
				}

			return arrOfNum;
		}


		//JavaScript function that returns the average / mean
		//value for all numbers in an array.
		function arrayAverage(arr){
			//Find the sum
			var sum = 0;
			for(var i in arr) {
				sum += arr[i];
			}
			//Get the length of the array
			var numbersCnt = arr.length;
			//Return the average / mean.
			return (sum / numbersCnt);
		}

		//JavaScript function that returns the stddev
		//value for all numbers in an array.
		function arrayStdDev(arr){
		
			//Find the sum
			var sum = 0;
	
			//get the mean of the values
			var mean = arrayAverage(arr)

			for(var i in arr) {
				var diff = arr[i]-mean
				var diffsquared = diff*diff
				sum += diffsquared
			}
			
			//Get the length of the array
			var numbersCnt = arr.length;
			var quotient = sum/(numbersCnt-1)
				
			return Math.sqrt(quotient);
		}
		
		//paints a smiley based on the z' factor obtained
		function smile(z) {
			var msg = document.getElementById('msg'); 
			msg.innerHTML = '&#128522;';
			if (z < 0.5) {msg.innerHTML = '&#128528;';}
			if (z < 0.0) {msg.innerHTML = '&#128561;';}
		}


		function calculate_Z() {
			
			//read out the form and calculate means and stddev
			control1 = document.getElementById("control1").value;
			control2 = document.getElementById("control2").value;
							
			control1_numbers = text_to_numeric_array(control1);
			control2_numbers = text_to_numeric_array(control2);
			
			mean1 = arrayAverage(control1_numbers)
			mean2 = arrayAverage(control2_numbers)
			
			sdev1 = arrayStdDev(control1_numbers)
			sdev2 = arrayStdDev(control2_numbers)
			
			//here is the formula for the Z' factor
			z = 1-((3*(sdev1+sdev2))/Math.abs(mean1-mean2))
		
			//display the results, if z' is not NaN
			
			if (!Number.isNaN(z)) {	
				document.getElementById("result").value = 	z.toFixed(2);
				smile(z)
			}
			}

		//document initialization
		window.onload = function () {
			document.getElementById("berechnen").onclick = calculate_Z;
		};
		</script>
	</head>
	
	<body>
		<h1>Z'-Factor</h1>
		<h2>Use this tool to calculate the Z'-factor based on the plate controls </h2>
          <main>
			<form>
		<table>
			<tr><label>Values Control 1 <br /><textarea id="control1" cols="50" rows="10">1233</textarea></label></tr>
			<tr><label>Values Control 2 <br /><textarea id="control2" cols="50" rows="10">2</textarea></label></tr>
			
				<tr>
					<td><label>Z'-factor:</label></td>
					<td><output id="result"></output></td>
					<td id="msg" style='font-size:50px;'></td>
				</tr>
			</table>
			<tr><button type="button" id="berechnen">Calculate Z'</button></tr>
			<p>Martin Neuenschwander, Aug 2022</p>
			</form>
	       </main>
	</body>
</html>
