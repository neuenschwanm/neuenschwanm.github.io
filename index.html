<!DOCTYPE html>
<html lang="en">
<script src='https://unpkg.com/simple-statistics@7.7.5/dist/simple-statistics.min.js'></script>

<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body {font-family: Arial;}

/* Style the tab */
.tab {
  overflow: hidden;
  border: 1px solid #ccc;
  background-color: #f1f1f1;
}

/* Style the buttons inside the tab */
.tab button {
  background-color: inherit;
  float: left;
  border: none;
  outline: none;
  cursor: pointer;
  padding: 14px 16px;
  transition: 0.3s;
  font-size: 17px;
}

/* Change background color of buttons on hover */
.tab button:hover {
  background-color: #ddd;
}

/* Create an active/current tablink class */
.tab button.active {
  background-color: #ccc;
}

/* Style the tab content */
.tabcontent {
  display: none;
  padding: 6px 12px;
  border: 1px solid #ccc;
  border-top: none;
}
</style>
</head>

<body>

<div class="tab">
  <button class="tablinks" onclick="openCity(event, 'tab1')">Z' Calculator</button>
  <button class="tablinks" onclick="openCity(event, 'tab2')">Competitive Inhibition</button>
</div>

<div id="tab1" class="tabcontent">
		<h4>Use this tool to calculate the Z'-factor based on the plate controls </h4>
		<form>
			<table>
				<tr>
					<td><label for="control1">Values Control 1</label></td>
					<td><label for="control2">Values Control 2</label></td>
				</tr>
				<tr>	
					<td><textarea id="control1" cols="20" rows="10"></textarea></td>
					<td><textarea id="control2" cols="20" rows="10"></textarea></td>					
				</tr>
				
				<tr>
					<tr><td><label for="outputZ">Z'-factor:</label></td></tr>
					<tr><td><output id="outputZ"></output></td></tr>
				</tr>
				<tr>
					<td id="msg" style='font-size:50px;'></td>
				</tr>
				<tr><td><button type="button" id="calculateZ">Calculate Z'</button></td></tr>
	
			</table>
		</form>	  
</div>

<div id="tab2" class="tabcontent">
 	<h4>Use this tool to calculate required Ki of an inhibitor to obtain a certain inhibition level</h4>
	<form>
			<table>
				<tr>
					<td><label for="c_inhibitor">Concentration Inhibitor (uM):</label> </td>
					<td><input type="number" id="c_inhibitor" value="10" name="c_inhibitor"></input></td>
				</tr>
				
				<tr>
					<td><label for="c_substrate">Concentration Substrate (uM):</label></td>
					<td><input type="number" id="c_substrate" name="c_substrate"></input></td>
				</tr>
				
				<tr>
					<td><label for="km_substrate">Km Substrate (uM):</label></td>
					<td><input type="number" id="km_substrate" name="km_substrate"></input></td>
				</tr>
			</table>
			<p>
			<table>
				<tr>
					<tr><td><label for="output_inhibition">%ResidualActivity - required Ki</label></td></tr>
					<tr><td><textarea id="output_inhibition" cols="50" rows="10"></textarea></td></tr>
				</tr>
				
				<tr>
					<td><button type="button" id="calculateinhib">Calculate</button></td>
				</tr>

			</table>
		</form>
</div>

<h6>Martin Neuenschwander, aug 2022</h6>
</body>

<script>
	function openCity(evt, cityName) {
	  var i, tabcontent, tablinks;
	  tabcontent = document.getElementsByClassName("tabcontent");
	  for (i = 0; i < tabcontent.length; i++) {
		tabcontent[i].style.display = "none";
	  }
	  tablinks = document.getElementsByClassName("tablinks");
	  for (i = 0; i < tablinks.length; i++) {
		tablinks[i].className = tablinks[i].className.replace(" active", "");
	  }
	  document.getElementById(cityName).style.display = "block";
	  evt.currentTarget.className += " active";
	}
</script>

	<script>
	//Z' factor
	
	//converts text column to numeric array
	function text_to_numeric_array (mytext) {			
		const arrOfStr = mytext.split("\n");			
		const arrOfNum = [];
			for(var s of arrOfStr) {			
				//test if it is not an empty string, this would be converted to 0
				if (s.length > 0) {
					//if the double number is in german notation with , as decimal separator, replace it with a .
					s=s.replace(",",".");	
					//test if the conversion of the string is NaN, if not, add to the numeric array
					if (!Number.isNaN(Number(s))) {
						arrOfNum.push(Number(s));
					}
				}
			}
		return arrOfNum;
	}

	//converts numeric array to text column
	function array_to_text(myarray) {
		var result = "";
		for (const n of myarray) {
			result = result + n.toString() + "\n";
		}
		return result;
	}

	//paints a smiley based on the Z' factor obtained
	function smile(z) {
		var msg = document.getElementById('msg'); 
		msg.innerHTML = '&#128522;';
		if (z < 0.5) {msg.innerHTML = '&#128528;';}
		if (z < 0.0) {msg.innerHTML = '&#128561;';}
	}

	//calculate and display the Z'-factor
	function calculate_Z() {
		
		//read out the form and get numeric arrays
		control1 = text_to_numeric_array(document.getElementById("control1").value);
		control2 = text_to_numeric_array(document.getElementById("control2").value);
						
		//calculate mean and standard deviations for both control groups
		mean1 = ss.mean(control1);
		mean2 = ss.mean(control2);
		
		sdev1 = ss.standardDeviation(control1);
		sdev2 = ss.standardDeviation(control2);
		
		//here is the formula for the Z' factor
		z = 1-((3*(sdev1+sdev2))/Math.abs(mean1-mean2));
	
		//display the results, if Z' is not NaN		
		if (!Number.isNaN(z)) {	
			document.getElementById("outputZ").value = z.toFixed(2);
			document.getElementById("control1").value = array_to_text(control1);
			document.getElementById("control2").value = array_to_text(control2);
			smile(z);
		}
	}


	</script>

		<script>
		//Competitive inhibition calculator
		
		function calculate_comp_inhibition() {
			
			//read out the form and convert to number
			Ci = Number(document.getElementById("c_inhibitor").value);
			Cs = Number(document.getElementById("c_substrate").value);
			Km = Number(document.getElementById("km_substrate").value);

			var result = "";
			var r;
			var Ki;
			
			for (var i = 1; i < 10; i++) {
				r = 1.0 - 0.1*i;
				Ki = (r * Km * Ci) / ((Cs + Km) * (1 - r));
				
				inhibition = 100 - 10*i;
				console.log(inhibition);
				result = result + String(inhibition) + "\t" + Ki.toPrecision(2) + "\n";	
			} 
	
				document.getElementById("output_inhibition").value = result;
		
			}

	
</script>

<script>
	//document initialization
		window.onload = function () {
			document.getElementById("calculateinhib").onclick = calculate_comp_inhibition;
			document.getElementById("calculateZ").onclick = calculate_Z;
		};
</script>

</html> 
